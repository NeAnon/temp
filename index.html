<!DOCTYPE html>
<html>
<head>
  <script type = "text/javascript">
    var fields;

    function openDefaultTab(){
     // Get the element with id="defaultOpen" and click on it  
      document.getElementById('defaultOpen').click();
      fields = 1;
    }

    function openTab(evt, TabName) {
      // Declare all variables
      var i, tabcontent, tabs;

      // Get all elements with class="tabcontent" and hide them
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }

      // Get all elements with class="tabs" and remove the class "active"
      tabs = document.getElementsByClassName("tabs");
      for (i = 0; i < tabs.length; i++) {
        tabs[i].className = tabs[i].className.replace("active", "");
      }
    

    // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById(TabName).style.display = "block";
      evt.currentTarget.className += "active";
    }

    //I don't know if I should trust this function. I might switch over to FileSaver.js in case of compat issues.

    function download(filename, content) {
      var element = document.createElement('a');                                                      //Create a new element (a hyperlink to a file)
      element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));   //The file contents are of a plaintext type
      element.setAttribute('download', filename);                                                     //And set to be downloaded upon submitting the form
      element.setAttribute('target', '_blank');    element.setAttribute('rel', "noopener noreferrer");    

      //This element is temporarily placed in the browser body, activated, and then removed.
      document.body.appendChild(element);
      element.click();
      document.body.removeChild(element);
    } 

    function addField(){
      //alert("Started...");
      var count = parseInt(document.getElementById("varList").getAttribute('value'));
      var varList = document.getElementById("varList");
      //alert(count);
      varList.setAttribute('value', count+1);
      //alert("value saved! Current count: " + varList.getAttribute('value'));
      element = document.createElement('input');
      element.type = "text";
      element.id= 'var'+(count);
      element.size=10;
      //alert("child created.");
      var ref = varList.appendChild(element);

      //alert("Child textbox added, id: " +(element.getAttribute('id')));
      
      linebreak = document.createElement("br");
      varList.appendChild(linebreak);

      alert(ref.id);
      if(parseInt(varList.getAttribute('value')) > 2){
        alert("More than 2 textboxes.");
        alert("Textbox 3 contents: " + document.getElementById("var2").value);
      }
    }
    
    function findAndReplaceAll(templateText, ){

    }

    function parseInputToText(templateText, input){
      returnString = templateText.replace('%s%', input);
      return returnString;
    }
    

  </script>
    
</head>
<body onload="openDefaultTab()">

  <!-- Tab links -->
  <div class="tab">
    <button class="tabs" onclick="openTab(event, 'Fill')" >Fill</button>
    <button class="tabs" onclick="openTab(event, 'Design')" id="defaultOpen">Design</button>
    <button class="tabs" onclick="openTab(event, 'Code')">Code</button>
  </div>

  <!-- Tab content -->
  <div id="Fill" class="tabcontent">
    <h3>Fill</h3>
    <div id = "varList" value = '0'>
    </div>
    <button onclick="download(getElementById('filenameInput').value, parseInputToText(getElementById('templateText').value, getElementById('vars').value));">Download</button>
  </div>

  <div id="Design" class="tabcontent">
    <h3>Design</h3>
    <button onclick="addField();">Add field</button>
    <button onclick="removeField();">Remove field</button>
  </div>

  <div id="Code" class="tabcontent">
    <h3>Code</h3>
    <div class="codeEntry">
      <textarea name="template" id="templateText"></textarea>
    </div>
    <input id="filenameInput" type="text" name="name" placeholder="filename.extension"> <br>
  </div> 

</body>
</html>